# US GPO Medicare & You 
# Assignment optimziation model written by Bill Seliger

setwd("C:/Users/rr046302/Documents/Customers/GPO/Medicare & You 2017/Mapping Data")

library("gurobi")

model <- list()
# matrix representing quantity by Handbook for each plant
# columns = plants * Versions (Handbooks)
# rows = handbooks + plants
model$A          <- matrix(c(
  c(rep(1818367,11)),c(rep(0,35*11)),
  c(rep(0,1*11)),c(rep(2496868,11)),c(rep(0,34*11)),
  c(rep(0,2*11)),c(rep(257789,11)),c(rep(0,33*11)),
  c(rep(0,3*11)),c(rep(848793,11)),c(rep(0,32*11)),
  c(rep(0,4*11)),c(rep(358645,11)),c(rep(0,31*11)),
  c(rep(0,5*11)),c(rep(285399,11)),c(rep(0,30*11)),
  c(rep(0,6*11)),c(rep(619993,11)),c(rep(0,29*11)),
  c(rep(0,7*11)),c(rep(514479,11)),c(rep(0,28*11)),
  c(rep(0,8*11)),c(rep(376205,11)),c(rep(0,27*11)),
  c(rep(0,9*11)),c(rep(857871,11)),c(rep(0,26*11)),
  c(rep(0,10*11)),c(rep(428549,11)),c(rep(0,25*11)),
  c(rep(0,11*11)),c(rep(619254,11)),c(rep(0,24*11)),
  c(rep(0,12*11)),c(rep(1452384,11)),c(rep(0,23*11)),
  c(rep(0,13*11)),c(rep(1651169,11)),c(rep(0,22*11)),
  c(rep(0,14*11)),c(rep(1582272,11)),c(rep(0,21*11)),
  c(rep(0,15*11)),c(rep(802776,11)),c(rep(0,20*11)),
  c(rep(0,16*11)),c(rep(718616,11)),c(rep(0,19*11)),
  c(rep(0,17*11)),c(rep(1186635,11)),c(rep(0,18*11)),
  c(rep(0,18*11)),c(rep(1731557,11)),c(rep(0,17*11)),
  c(rep(0,19*11)),c(rep(1237234,11)),c(rep(0,16*11)),
  c(rep(0,20*11)),c(rep(306852,11)),c(rep(0,15*11)),
  c(rep(0,21*11)),c(rep(1038711,11)),c(rep(0,14*11)),
  c(rep(0,22*11)),c(rep(1353168,11)),c(rep(0,13*11)),
  c(rep(0,23*11)),c(rep(691245,11)),c(rep(0,12*11)),
  c(rep(0,24*11)),c(rep(236866,11)),c(rep(0,11*11)),
  c(rep(0,25*11)),c(rep(201868,11)),c(rep(0,10*11)),
  c(rep(0,26*11)),c(rep(926092,11)),c(rep(0,9*11)),
  c(rep(0,27*11)),c(rep(258658,11)),c(rep(0,8*11)),
  c(rep(0,28*11)),c(rep(138186,11)),c(rep(0,7*11)),
  c(rep(0,29*11)),c(rep(657088,11)),c(rep(0,6*11)),
  c(rep(0,30*11)),c(rep(218927,11)),c(rep(0,5*11)),
  c(rep(0,31*11)),c(rep(876851,11)),c(rep(0,4*11)),
  c(rep(0,32*11)),c(rep(430796,11)),c(rep(0,3*11)),
  c(rep(0,33*11)),c(rep(733698,11)),c(rep(0,2*11)),
  c(rep(0,34*11)),c(rep(581636,11)),c(rep(0,1*11)),
  c(rep(0,35*11)),c(rep(232633,11)), 
  
  1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,c(rep(0,10)),
  
  0,1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,c(rep(0,9)),
  
  c(rep(0,2)),1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,c(rep(0,8)),
  
  c(rep(0,3)),1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,c(rep(0,7)),
  
  c(rep(0,4)),1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,c(rep(0,6)),
  
  c(rep(0,5)),1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,c(rep(0,5)),
  
  c(rep(0,6)),1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,c(rep(0,4)),
  
  c(rep(0,7)),1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,c(rep(0,3)),
  
  c(rep(0,8)),1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,c(rep(0,2)),
  
  c(rep(0,9)),1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633,0,
 
   c(rep(0,10)),1818367,c(rep(0,10)),2496868,c(rep(0,10)),257789,c(rep(0,10)),848793,c(rep(0,10)),358645,c(rep(0,10)),285399,c(rep(0,10)),619993,c(rep(0,10)),
  514479,c(rep(0,10)),376205,c(rep(0,10)),857871,c(rep(0,10)),428549,c(rep(0,10)),619254,c(rep(0,10)),1452384,c(rep(0,10)),1651169,c(rep(0,10)),
  1582272,c(rep(0,10)),802776,c(rep(0,10)),718616,c(rep(0,10)),1186635,c(rep(0,10)),1731557,c(rep(0,10)),1237234,c(rep(0,10)),306852,c(rep(0,10)),
  1038711,c(rep(0,10)),1353168,c(rep(0,10)),691245,c(rep(0,10)),236866,c(rep(0,10)),201868,c(rep(0,10)),926092,c(rep(0,10)),258658,c(rep(0,10)),138186,c(rep(0,10)),
  657088,c(rep(0,10)),218927,c(rep(0,10)),876851,c(rep(0,10)),430796,c(rep(0,10)),733698,c(rep(0,10)),581636,c(rep(0,10)),232633),
  
  nrow=47, ncol=396, byrow=T)

model$obj        <- c(
  3816206823,4349352027,4298255915,3280152231,3471626276,3858756611,4000771073,3666191545,3822207434,5043786385,4396811406,
  4957781101,5402473292,5233185641,4075887323,4817207432,4875634144,5210963516,4389993318,4966020765,6460645950,5755031053,
  890660995,1035048614,1038734997,925978088,807317811,975654028,902364616,980706693,948740857,1108750489,1017029163,
  1484538957,1563052310,1505504144,1077542714,1456698547,1383956987,1570691447,1218866748,1444900324,1922770783,1699962620,
  616618349,694623636,674145007,489944935,596426635,616008652,653020816,553066455,617837742,850454889,731169562,
  367394133,393793540,374414948,230545312,358004506,333545811,396362131,278064246,354065999,514717097,439828399,
  602447198,733575718,716215914,379745713,567541592,597611253,665376488,500706347,604555174,1003334672,800472962,
  436072400,431853673,396560413,189379720,468433130,323298604,493282465,223232438,360238196,649426842,514839135,
  262026783,293816105,283244745,81636485,285652457,211314349,300211590,152475887,230877009,457502901,351413091,
  426447674,505200232,481179844,15098530,480407760,317069122,513521581,182898097,355501742,878459904,636540282,
  382437128,259015016,217445763,311083719,496602581,239258907,397693472,233987754,296855892,385051277,380637222,
  666688856,447287164,387219526,542528429,831658122,459796095,688734299,452179271,542961907,621483314,623031449,
  688865731,550453536,660689482,1087980854,1187178682,625687027,697289558,895830451,511239168,705422909,186921821,
  898070819,370192090,495515817,1088780839,1464586903,532502003,907482482,832189176,574441695,595081308,153063366,
  297150682,599839315,622307578,782908186,840028205,289872230,296043091,602687405,154587974,1044932429,481960051,
  93362849,382362209,393761628,442570409,368795294,218997293,82364818,367270020,140004134,611875867,326248166,
  712651487,296932131,319568535,713801273,959208637,548950762,716819460,596163834,571802751,312741683,437062251,
  1074497993,429561870,373908689,950138645,1481632461,677805912,1084465727,755886495,835865694,688129637,788637621,
  2174835592,1207241540,1152524339,1993368418,2768932799,1595976087,2189380671,1709739382,1826619479,1256071448,1555630809,
  1948519827,1297611019,1218180596,1818857703,2373014812,1535036224,1958912592,1616322498,1699835793,1332501018,1546542500,
  208536619,64715087,94940009,230998186,313817540,140630272,210316361,180766513,148424312,87483505,78124519,
  1141024034,654180188,721592532,1217057679,1497405778,911157289,1147048557,1047020688,937540549,247524831,637664683,
  1296334944,513527256,556152048,1298500013,1760606885,988083274,1304048002,1076986411,1031114016,467384227,701482291,
  157880358,545115807,554931486,291843639,85230509,385852959,189262881,386336831,313617857,742742753,496797782,
  103913114,183594837,176962589,44341315,90459125,126983863,127955013,94627967,104694772,263845037,179544428,
  93182269,206248536,209115061,121665844,27918344,159738148,102326889,164502233,138663129,263962597,192137962,
  1744664719,2263368848,2246977020,1728458109,1445166566,1988134306,1786616686,1925067440,1953313246,2528138551,2198635017,
  353766547,429605072,422362648,277514168,333979210,359819144,380020334,332427262,354620118,528386562,436356046,
  128913719,89102333,102713654,154035934,176325336,107481071,129715198,132561830,110977177,26130973,62653532,
  320856070,54538304,62883322,332946490,546368672,160526598,324667181,225315475,192132531,349636525,200017587,
  364360206,428549603,422419647,299842419,297543686,369504991,386581297,346320621,365104558,512179717,434285490,
  326188572,170635205,183174174,423343663,627036150,127932561,331274308,287081017,154325776,473061115,225701447,
  130315790,287642489,293759792,77500200,157412858,172275320,174041584,140956451,131780496,421189249,267912032,
  622836232,280052527,208883821,545944682,874568016,377634361,628999295,421289392,475362934,485487967,488202649,
  1133724891,1386154915,1369869107,1044152947,945681972,1229229522,1160073002,1167634270,1217538639,1608281704,1401335615,
  248242674,378540418,369072255,238821038,173032425,309401890,258780949,288209024,300654889,445050192,362279371
)

# minimiZe total weighted miles
model$modelsense <- "min"

# RHS is first Demand constraints then capacity constraints
model$rhs        <- c(
  1818367,2496868,257789,848793,358645,285399,619993,514479,376205,857871,
  428549,619254,1452384,1651169,1582272,802776,718616,1186635,1731557,1237234,
  306852,1038711,1353168,691245,236866,201868,926092,258658,138186,657088,218927,
  876851,430796,733698,581636,232633,
  1200000,7000000,1400000,1000000,2200000,7200000,3500000,1600000,1200000,800000,2300000)

# RHS inequality, first 36 '=' demand, next 11 '<=' capacity
model$sense      <- c(c(rep('=',36)),c(rep('<=',11)))
model$vtype      <- 'B'

params <- list(OutputFlag=0)

result <- gurobi(model, params)

print('Solution:')
print(result$status)
print(result$runtime)
print(result$objval)
print(result$x)

Decision <- as.data.frame(matrix(result$x, ncol=11, byrow=TRUE),row.names = c(
  "Northern California","Southern California","Alaska & Hawaii",
"Arizona","Nevada","New Mexico","Colorado","Oklahoma","Kansas","Missouri","Mississippi","Louisiana","Michigan",
"Ohio","Illinois","Wisconsin","South Carolina","Georgia","Northern Florida","Southern Florida","West Viginia",
"Virginia","North Carolina","Minnesota","Nebraska","North Dakota and South Dakota","Washington","Utah","Delaware",
"Kentucky","Idaho","Indiana","Iowa","Alabama","Oregon","Montana and Wyoming"))

colnames(Decision) <- (c("Baraboo WI","Danville KY","Glasgow KY","Liberty MO","Long Prairie MN",
               "Mattoon IL","Menasha WI","Owensville MO","Pontiac IL","Strasburg VA","Willard OH"))
             
write.csv(Decision,file ="Decision.csv")

View(Decision)

###





